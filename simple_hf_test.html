<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ HuggingFace Model Tester - Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #00d9ff;
        }
        textarea {
            width: 100%;
            height: 120px;
            background: #0a0a0a;
            color: white;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 10px;
            font-family: inherit;
            box-sizing: border-box;
        }
        select, button {
            background: #0a0a0a;
            color: white;
            border: 2px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        button {
            background: linear-gradient(45deg, #00ff88, #00d9ff);
            color: black;
            font-weight: bold;
        }
        button:hover {
            opacity: 0.8;
        }
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
        .result {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #00ff88;
        }
        .error {
            border-left-color: #ff4444;
        }
        .boilerplate {
            border-left-color: #ff8800;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #333;
            border-top: 3px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="color: #00d9ff; margin: 0;">üß™ HuggingFace Model Tester</h1>
            <p>Test HuggingFace models to verify genuine AI responses</p>
        </div>

        <div class="test-section">
            <h3 style="color: #00ff88; margin-top: 0;">üìù Test Configuration</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Test Journal Entry:</label>
                <textarea id="testText" placeholder="Enter a journal entry to test...">Today was an amazing day! I finally completed the project I've been working on for weeks. The client was thrilled with the results, and my team celebrated with coffee. I feel so accomplished and proud of what we achieved together. This success makes me excited about future challenges.</textarea>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">HuggingFace Model:</label>
                <select id="modelSelect" style="width: 100%;">
                    <option value="hf-mistral-7b">üéØ Mistral 7B - Excellent Instructions</option>
                    <option value="hf-phi3-medium">üí° Phi-3 Medium - Advanced Reasoning</option>
                    <option value="hf-gemma-7b">üíé Gemma 7B - Google's Safe AI</option>
                    <option value="hf-zephyr-7b">üåü Zephyr 7B - Helpful Conversations</option>
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Analysis Type:</label>
                <select id="analysisType" style="width: 100%;">
                    <option value="sentiment">Sentiment Analysis</option>
                    <option value="insights">Personal Insights</option>
                    <option value="summarize">Text Summary</option>
                </select>
            </div>

            <div style="text-align: center;">
                <button onclick="testModel()" id="testBtn">üöÄ Test Selected Model</button>
                <button onclick="testAllModels()" id="testAllBtn">üß™ Test All Models</button>
                <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
            </div>
        </div>

        <div id="loadingSection" style="display: none;">
            <div class="loading">
                <div class="spinner"></div>
                <p>Testing HuggingFace model...</p>
            </div>
        </div>

        <div id="resultsSection">
            <!-- Results will appear here -->
        </div>

        <div class="test-section">
            <h3 style="color: #00d9ff; margin-top: 0;">üìä API Status</h3>
            <div id="apiStatus">
                <p>üîç Click "Test API Connection" to verify backend connectivity</p>
                <button onclick="testAPIConnection()">üåê Test API Connection</button>
            </div>
        </div>
    </div>

    <script>
        const RAILWAY_API = 'https://ai-journal-backend-production.up.railway.app';
        
        const HF_MODELS = [
            { id: 'hf-mistral-7b', name: 'üéØ Mistral 7B', description: 'Excellent Instructions' },
            { id: 'hf-phi3-medium', name: 'üí° Phi-3 Medium', description: 'Advanced Reasoning' },
            { id: 'hf-gemma-7b', name: 'üíé Gemma 7B', description: 'Google Safe AI' },
            { id: 'hf-zephyr-7b', name: 'üåü Zephyr 7B', description: 'Helpful Conversations' }
        ];

        function showLoading(show) {
            document.getElementById('loadingSection').style.display = show ? 'block' : 'none';
        }

        function addResult(title, content, type = 'success') {
            const resultsSection = document.getElementById('resultsSection');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.innerHTML = `
                <h4 style="margin-top: 0; color: #00d9ff;">${title} - ${timestamp}</h4>
                <div>${content}</div>
            `;
            
            resultsSection.insertBefore(resultDiv, resultsSection.firstChild);
        }

        function isBoilerplateResponse(response) {
            const boilerplateIndicators = [
                "I don't have access",
                "I cannot analyze",
                "Based on the general",
                "This appears to be",
                "I'm not able to",
                "As an AI, I cannot",
                "I apologize, but I cannot",
                "fallback response",
                "Unfortunately, I cannot access"
            ];
            
            const text = response.toLowerCase();
            return boilerplateIndicators.some(indicator => text.includes(indicator.toLowerCase()));
        }

        async function testModel() {
            const text = document.getElementById('testText').value.trim();
            const model = document.getElementById('modelSelect').value;
            const analysisType = document.getElementById('analysisType').value;
            
            if (!text) {
                alert('Please enter a test journal entry!');
                return;
            }

            const modelInfo = HF_MODELS.find(m => m.id === model);
            const testBtn = document.getElementById('testBtn');
            
            testBtn.disabled = true;
            testBtn.textContent = 'üîÑ Testing...';
            showLoading(true);

            try {
                console.log(`Testing ${model} with ${analysisType}...`);
                
                const response = await fetch(`${RAILWAY_API}/api/ai/${analysisType}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        task_type: analysisType,
                        model: model
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    const isBoilerplate = isBoilerplateResponse(result.result || '');
                    
                    const resultType = isBoilerplate ? 'boilerplate' : 'success';
                    const statusIcon = isBoilerplate ? '‚ö†Ô∏è' : '‚úÖ';
                    const statusText = isBoilerplate ? 'Boilerplate Response' : 'Genuine AI Response';
                    
                    const content = `
                        <p><strong>${statusIcon} ${statusText}</strong></p>
                        <p><strong>Model:</strong> ${modelInfo.name}</p>
                        <p><strong>Confidence:</strong> ${Math.round((result.confidence || 0) * 100)}%</p>
                        <p><strong>Response Length:</strong> ${(result.result || '').length} characters</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong>AI Response:</strong><br>
                            ${result.result || 'No response'}
                        </div>
                    `;
                    
                    addResult(`${modelInfo.name} - ${analysisType}`, content, resultType);
                    
                } else {
                    const errorText = await response.text();
                    addResult(`${modelInfo.name} - Error`, `
                        <p><strong>‚ùå HTTP Error ${response.status}</strong></p>
                        <pre>${errorText}</pre>
                    `, 'error');
                }
                
            } catch (error) {
                addResult(`${modelInfo.name} - Exception`, `
                    <p><strong>‚ùå Network/Connection Error</strong></p>
                    <p>${error.message}</p>
                `, 'error');
            }

            testBtn.disabled = false;
            testBtn.textContent = 'üöÄ Test Selected Model';
            showLoading(false);
        }

        async function testAllModels() {
            const text = document.getElementById('testText').value.trim();
            const analysisType = document.getElementById('analysisType').value;
            
            if (!text) {
                alert('Please enter a test journal entry!');
                return;
            }

            const testAllBtn = document.getElementById('testAllBtn');
            testAllBtn.disabled = true;
            testAllBtn.textContent = 'üîÑ Testing All...';
            
            for (const modelInfo of HF_MODELS) {
                document.getElementById('modelSelect').value = modelInfo.id;
                await testModel();
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            testAllBtn.disabled = false;
            testAllBtn.textContent = 'üß™ Test All Models';
        }

        async function testAPIConnection() {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.innerHTML = '<p>üîÑ Testing API connection...</p>';
            
            try {
                const response = await fetch(`${RAILWAY_API}/health`);
                if (response.ok) {
                    const data = await response.json();
                    statusDiv.innerHTML = `
                        <p>‚úÖ <strong>API Connected Successfully!</strong></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        <button onclick="testAPIConnection()">üîÑ Refresh Status</button>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <p>‚ùå <strong>API Error:</strong> HTTP ${response.status}</p>
                        <button onclick="testAPIConnection()">üîÑ Retry Connection</button>
                    `;
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <p>‚ùå <strong>Connection Failed:</strong> ${error.message}</p>
                    <button onclick="testAPIConnection()">üîÑ Retry Connection</button>
                `;
            }
        }

        function clearResults() {
            document.getElementById('resultsSection').innerHTML = '';
        }

        // Test API connection on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ HuggingFace Model Tester loaded');
            testAPIConnection();
        });
    </script>
</body>
</html>
