<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ HuggingFace Model Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            margin: 0;
            padding: 2rem;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .test-card {
            background: rgba(26, 26, 46, 0.9);
            border: 2px solid #00d9ff;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .model-card {
            background: rgba(10, 10, 10, 0.6);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 1rem;
        }
        .model-card.testing {
            border-color: #ffaa00;
        }
        .model-card.success {
            border-color: #00ff88;
        }
        .model-card.error {
            border-color: #ff4444;
        }
        .model-card.boilerplate {
            border-color: #ff8800;
        }
        button {
            background: linear-gradient(135deg, #00ff88, #00d9ff);
            color: #000;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(10, 10, 10, 0.8);
            border: 2px solid #333;
            border-radius: 8px;
            color: #ffffff;
            padding: 1rem;
            font-family: inherit;
            resize: vertical;
            box-sizing: border-box;
        }
        select {
            width: 100%;
            padding: 0.8rem;
            background: rgba(10, 10, 10, 0.8);
            border: 2px solid #333;
            border-radius: 8px;
            color: #ffffff;
            font-size: 1rem;
        }
        .response {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .genuine { color: #00ff88; }
        .boilerplate { color: #ff8800; }
        .error { color: #ff4444; }
        .testing { color: #ffaa00; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top: 2px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="color: #00d9ff; font-size: 2.5rem;">üß™ HuggingFace Model Tester</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Test all HuggingFace models to verify genuine AI responses</p>
        </div>

        <!-- Test Configuration -->
        <div class="test-card">
            <h3 style="color: #00ff88; margin-top: 0;">üìù Test Configuration</h3>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Test Journal Entry:</label>
                <textarea id="testText" placeholder="Enter a journal entry to test with all HuggingFace models...">Today was an amazing day! I finally completed the project I've been working on for weeks. The client was thrilled with the results, and my team celebrated with coffee. I feel so accomplished and proud of what we achieved together. This success makes me excited about future challenges and reminds me how much I love what I do.</textarea>
            </div>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Analysis Type:</label>
                <select id="analysisType">
                    <option value="sentiment">Sentiment Analysis</option>
                    <option value="insights">Personal Insights</option>
                    <option value="summarize">Text Summary</option>
                </select>
            </div>

            <div style="text-align: center;">
                <button onclick="testAllHFModels()" id="testBtn">üöÄ Test All HuggingFace Models</button>
                <button onclick="testSingleModel()" id="singleBtn">üéØ Test Selected Model Only</button>
                <button onclick="clearResults()" style="background: rgba(255,255,255,0.1); color: #fff;">üóëÔ∏è Clear Results</button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="test-card">
            <h3 style="color: #00d9ff; margin-top: 0;">üìä Test Statistics</h3>
            <div class="stats">
                <div class="stat-card">
                    <div style="font-size: 2rem;" id="totalTests">0</div>
                    <div>Total Tests</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; color: #00ff88;" id="successfulTests">0</div>
                    <div>Successful</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; color: #ff8800;" id="boilerplateTests">0</div>
                    <div>Boilerplate</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; color: #ff4444;" id="failedTests">0</div>
                    <div>Failed</div>
                </div>
            </div>
        </div>

        <!-- Model Results -->
        <div class="test-card">
            <h3 style="color: #00d9ff; margin-top: 0;">ü§ñ Model Test Results</h3>
            <div class="model-grid" id="modelResults">
                <!-- Dynamic model cards will be inserted here -->
            </div>
        </div>

        <!-- Single Model Test -->
        <div class="test-card">
            <h3 style="color: #00ff88; margin-top: 0;">üéØ Single Model Test</h3>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Select HuggingFace Model:</label>
                <select id="singleModel">
                    <option value="hf-mistral-7b">üéØ Mistral 7B - Excellent Instructions</option>
                    <option value="hf-phi3-medium">üí° Phi-3 Medium - Advanced Reasoning</option>
                    <option value="hf-gemma-7b">üíé Gemma 7B - Google's Safe AI</option>
                    <option value="hf-zephyr-7b">üåü Zephyr 7B - Helpful Conversations</option>
                </select>
            </div>
            <div id="singleResult"></div>
        </div>
    </div>

    <script>
        const RAILWAY_API = 'https://ai-journal-backend-production.up.railway.app';
        
        const HF_MODELS = [
            { id: 'hf-mistral-7b', name: 'üéØ Mistral 7B', description: 'Excellent Instructions' },
            { id: 'hf-phi3-medium', name: 'üí° Phi-3 Medium', description: 'Advanced Reasoning' },
            { id: 'hf-gemma-7b', name: 'üíé Gemma 7B', description: 'Google Safe AI' },
            { id: 'hf-zephyr-7b', name: 'üåü Zephyr 7B', description: 'Helpful Conversations' }
        ];

        let testResults = {
            total: 0,
            successful: 0,
            boilerplate: 0,
            failed: 0
        };

        function updateStats() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('successfulTests').textContent = testResults.successful;
            document.getElementById('boilerplateTests').textContent = testResults.boilerplate;
            document.getElementById('failedTests').textContent = testResults.failed;
        }

        function isBoilerplateResponse(response) {
            const boilerplateIndicators = [
                "I don't have access",
                "I cannot analyze",
                "Based on the general",
                "This appears to be",
                "I'm not able to",
                "As an AI, I cannot",
                "I apologize, but I cannot",
                "fallback response",
                "Unfortunately, I cannot access"
            ];
            
            const text = response.toLowerCase();
            return boilerplateIndicators.some(indicator => text.includes(indicator.toLowerCase()));
        }

        async function testModel(modelId, modelName, text, analysisType) {
            console.log(`Testing ${modelId} for ${analysisType}...`);
            
            try {
                const response = await fetch(`${RAILWAY_API}/api/ai/${analysisType}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        task_type: analysisType,
                        model: modelId
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    const isBoilerplate = isBoilerplateResponse(result.result || '');
                    
                    testResults.total++;
                    testResults.successful++;
                    if (isBoilerplate) {
                        testResults.boilerplate++;
                    }
                    
                    return {
                        success: true,
                        model: modelId,
                        modelName: modelName,
                        response: result.result || 'No response',
                        confidence: result.confidence || 0,
                        isBoilerplate: isBoilerplate,
                        metadata: result.metadata || {}
                    };
                } else {
                    testResults.total++;
                    testResults.failed++;
                    
                    return {
                        success: false,
                        model: modelId,
                        modelName: modelName,
                        error: `HTTP ${response.status}: ${response.statusText}`
                    };
                }
            } catch (error) {
                testResults.total++;
                testResults.failed++;
                
                return {
                    success: false,
                    model: modelId,
                    modelName: modelName,
                    error: error.message
                };
            }
        }

        function createModelCard(result) {
            const card = document.createElement('div');
            card.className = 'model-card';
            
            if (result.success) {
                if (result.isBoilerplate) {
                    card.classList.add('boilerplate');
                } else {
                    card.classList.add('success');
                }
            } else {
                card.classList.add('error');
            }

            const statusClass = result.success ? 
                (result.isBoilerplate ? 'boilerplate' : 'genuine') : 'error';
            
            const statusText = result.success ? 
                (result.isBoilerplate ? '‚ö†Ô∏è Boilerplate Response' : '‚úÖ Genuine AI Response') : 
                '‚ùå Failed';

            card.innerHTML = `
                <h4>${result.modelName}</h4>
                <div class="status ${statusClass}">${statusText}</div>
                ${result.success ? `
                    <div style="margin: 0.5rem 0; font-size: 0.9rem; color: #ccc;">
                        Confidence: ${Math.round((result.confidence || 0) * 100)}%
                    </div>
                    <div class="response">
                        ${result.response.substring(0, 300)}${result.response.length > 300 ? '...' : ''}
                    </div>
                ` : `
                    <div class="response">
                        <strong>Error:</strong> ${result.error}
                    </div>
                `}
            `;

            return card;
        }

        async function testAllHFModels() {
            const text = document.getElementById('testText').value.trim();
            const analysisType = document.getElementById('analysisType').value;
            
            if (!text) {
                alert('Please enter a test journal entry first!');
                return;
            }

            // Reset results
            testResults = { total: 0, successful: 0, boilerplate: 0, failed: 0 };
            
            const testBtn = document.getElementById('testBtn');
            const resultsContainer = document.getElementById('modelResults');
            
            testBtn.disabled = true;
            testBtn.innerHTML = '<div class="spinner"></div>Testing All Models...';
            resultsContainer.innerHTML = '';

            // Create loading cards
            HF_MODELS.forEach(model => {
                const loadingCard = document.createElement('div');
                loadingCard.className = 'model-card testing';
                loadingCard.innerHTML = `
                    <h4>${model.name}</h4>
                    <div class="status testing"><div class="spinner"></div>Testing...</div>
                    <div style="font-size: 0.9rem; color: #ccc;">${model.description}</div>
                `;
                resultsContainer.appendChild(loadingCard);
            });

            // Test each model
            for (let i = 0; i < HF_MODELS.length; i++) {
                const model = HF_MODELS[i];
                const result = await testModel(model.id, model.name, text, analysisType);
                
                // Replace loading card with result
                const cards = resultsContainer.querySelectorAll('.model-card');
                const resultCard = createModelCard(result);
                resultsContainer.replaceChild(resultCard, cards[i]);
                
                updateStats();
                
                // Small delay between requests
                if (i < HF_MODELS.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }

            testBtn.disabled = false;
            testBtn.innerHTML = 'üöÄ Test All HuggingFace Models';
            
            // Show summary
            console.log('Test Summary:', testResults);
        }

        async function testSingleModel() {
            const text = document.getElementById('testText').value.trim();
            const analysisType = document.getElementById('analysisType').value;
            const modelId = document.getElementById('singleModel').value;
            
            if (!text) {
                alert('Please enter a test journal entry first!');
                return;
            }

            const model = HF_MODELS.find(m => m.id === modelId);
            const singleBtn = document.getElementById('singleBtn');
            const resultContainer = document.getElementById('singleResult');
            
            singleBtn.disabled = true;
            singleBtn.innerHTML = '<div class="spinner"></div>Testing...';
            
            resultContainer.innerHTML = '<div class="status testing"><div class="spinner"></div>Testing model...</div>';

            const result = await testModel(modelId, model.name, text, analysisType);
            const resultCard = createModelCard(result);
            
            resultContainer.innerHTML = '';
            resultContainer.appendChild(resultCard);
            
            singleBtn.disabled = false;
            singleBtn.innerHTML = 'üéØ Test Selected Model Only';
        }

        function clearResults() {
            document.getElementById('modelResults').innerHTML = '';
            document.getElementById('singleResult').innerHTML = '';
            testResults = { total: 0, successful: 0, boilerplate: 0, failed: 0 };
            updateStats();
        }

        // Initialize
        updateStats();
        
        // Test API connectivity on load
        fetch(`${RAILWAY_API}/health`)
            .then(response => response.json())
            .then(data => {
                console.log('‚úÖ API connected:', data);
            })
            .catch(error => {
                console.error('‚ùå API connection failed:', error);
                alert('‚ö†Ô∏è Cannot connect to Railway API. Please check the backend is running.');
            });
    </script>
</body>
</html>
