<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ü§ñ AI Journal Summarizer</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
        }
        .title {
            color: #00d9ff;
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }
        .subtitle {
            color: #ffffff;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        .card {
            background: rgba(26, 26, 46, 0.9);
            padding: 2rem;
            border: 2px solid #00d9ff;
            border-radius: 15px;
            margin: 1rem 0;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.2);
        }
        .success {
            color: #00ff88;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .journal-section {
            width: 100%;
            max-width: 800px;
            margin: 2rem 0;
        }
        .input-container {
            position: relative;
            width: 100%;
        }
        #journalInput {
            width: 100%;
            min-height: 200px;
            padding: 1.5rem;
            background: rgba(10, 10, 10, 0.8);
            border: 2px solid #333;
            border-radius: 10px;
            color: #ffffff;
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        #journalInput:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }
        #journalInput::placeholder {
            color: #666;
            font-style: italic;
        }
        .input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        #charCount {
            color: #888;
            font-size: 0.9rem;
        }
        #analyzeBtn {
            background: linear-gradient(135deg, #00ff88, #00d9ff);
            color: #000;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #analyzeBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        #analyzeBtn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        #resultsSection {
            display: none;
            width: 100%;
            max-width: 800px;
            margin: 2rem auto;
        }
        #resultsSection.active {
            display: block;
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .results-header h2 {
            color: #00d9ff;
            margin: 0;
        }
        .new-entry-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 2px solid #00d9ff;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .new-entry-btn:hover {
            background: rgba(0, 217, 255, 0.1);
            transform: translateY(-1px);
        }
        .analysis-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        .analysis-card {
            background: rgba(10, 10, 10, 0.6);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .analysis-card:hover {
            border-color: #00ff88;
            transform: translateY(-2px);
        }
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .card-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
        .card-header h3 {
            margin: 0;
            color: #ffffff;
            font-size: 1.1rem;
        }
        .card-content {
            color: #cccccc;
            line-height: 1.6;
        }
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 2px solid #ff4444;
            color: #ff4444;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        .error-message.active {
            display: block;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .title {
                font-size: 2rem;
            }
            .subtitle {
                font-size: 1.2rem;
            }
            .input-footer {
                flex-direction: column;
                align-items: stretch;
            }
            #analyzeBtn {
                width: 100%;
            }
            .analysis-cards {
                grid-template-columns: 1fr;
            }
        }
        .btn {
            background: linear-gradient(45deg, #00d9ff, #0099cc);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 217, 255, 0.4);
        }
        .debug {
            background: rgba(42, 42, 62, 0.8);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            text-align: left;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ü§ñ AI Journal Summarizer</h1>
        <p class="subtitle">Transform your thoughts into insights with AI</p>
        
        <!-- Journal Entry Section -->
        <div class="journal-section">
            <div class="card">
                <h3 style="margin-top: 0; color: #00d9ff;">‚úçÔ∏è Write Your Journal Entry</h3>
                
                <!-- Model Selection -->
                <div style="margin-bottom: 1.5rem;">
                    <label for="modelSelect" style="display: block; margin-bottom: 0.5rem; color: #cccccc; font-weight: bold;">
                        üß† AI Model Selection:
                    </label>
                    <select id="modelSelect" style="
                        width: 100%; 
                        padding: 0.8rem; 
                        background: rgba(10, 10, 10, 0.8); 
                        border: 2px solid #333; 
                        border-radius: 8px; 
                        color: #ffffff; 
                        font-size: 1rem;
                        box-sizing: border-box;
                    ">
                        <option value="groq-llama3-8b">üöÄ Llama 3 8B - Fast & Efficient (Recommended)</option>
                        <option value="groq-llama3-70b">üß† Llama 3 70B - Most Capable & Detailed</option>
                        <option value="groq-mixtral">‚ö° Mixtral 8x7B - Balanced Performance</option>
                        <optgroup label="ü§ó HuggingFace Models (More Variety)">
                            <option value="hf-mistral-7b">üéØ Mistral 7B - Excellent Instructions</option>
                            <option value="hf-phi3-medium">üí° Phi-3 Medium - Advanced Reasoning</option>
                            <option value="hf-gemma-7b">üíé Gemma 7B - Google's Safe AI</option>
                            <option value="hf-zephyr-7b">üåü Zephyr 7B - Helpful Conversations</option>
                        </optgroup>
                    </select>
                    <p style="font-size: 0.9rem; color: #888; margin: 0.5rem 0 0 0; font-style: italic;">
                        üí° Larger models provide more detailed insights but may take slightly longer
                    </p>
                </div>
                
                <div class="input-container">
                    <textarea 
                        id="journalInput" 
                        placeholder="Share your thoughts, feelings, or experiences... Write about your day, reflect on your emotions, or explore your ideas. The AI will analyze your entry and provide insights about your sentiment, personal themes, and a helpful summary."
                        maxlength="5000"
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="input-footer">
                        <span id="charCount">0/5000 characters</span>
                        <button id="analyzeBtn" onclick="analyzeEntry()" disabled>
                            ü§ñ Analyze with AI
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- User Guidance Section -->
            <div class="card" style="margin-top: 1rem; border-color: #666;">
                <h4 style="margin-top: 0; color: #00ff88;">üí° How to Get the Most from AI Journal Analysis</h4>
                <div style="text-align: left; color: #cccccc; line-height: 1.6;">
                    <p><strong>For Better Sentiment Analysis:</strong> Include specific emotions, describe how events made you feel, mention your reactions to situations.</p>
                    <p><strong>For Deeper Insights:</strong> Write about patterns you notice, challenges you're facing, goals you're working toward, or relationships in your life.</p>
                    <p><strong>For Useful Summaries:</strong> Include key events, decisions made, lessons learned, or important realizations you had.</p>
                    <p style="margin-bottom: 0;"><strong>Example:</strong> Instead of "Had a good day," try "Today's presentation went well, which boosted my confidence. I felt proud of how I handled the difficult questions, and it made me realize I've grown more comfortable with public speaking."</p>
                </div>
            </div>
        </div>
        </div>

        <!-- Loading Section -->
        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>ü§ñ AI is analyzing your journal entry...</p>
            <p style="color: #888; font-size: 0.9rem;">This may take a few seconds</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <strong>‚ö†Ô∏è Analysis Error</strong>
            <p id="errorText">Something went wrong. Please try again.</p>
        </div>

        <!-- Status Section -->
        <div class="card" style="margin-top: 3rem; background: rgba(0, 0, 0, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <div><strong>üåê Status:</strong> <span id="status" style="color: #00ff88;">Ready</span></div>
                    <div><strong>üöÇ Backend:</strong> Railway API Connected</div>
                </div>
                <div>
                    <button class="btn" onclick="testRailwayAPI()" style="background: rgba(0, 217, 255, 0.1); border: 1px solid #00d9ff; color: #00d9ff; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                        Test API
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection">
            <div class="results-header">
                <h2>ü§ñ AI Analysis Results</h2>
                <button class="new-entry-btn" onclick="startNewEntry()">‚úçÔ∏è New Entry</button>
            </div>
            
            <div class="analysis-cards">
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">ÔøΩ</span>
                        <h3>Sentiment Analysis</h3>
                    </div>
                    <div class="card-content" id="sentimentContent">
                        <p>Loading sentiment analysis...</p>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">ÔøΩ</span>
                        <h3>Personal Insights</h3>
                    </div>
                    <div class="card-content" id="insightsContent">
                        <p>Loading personal insights...</p>
                    </div>
                </div>
                
                <div class="analysis-card">
                    <div class="card-header">
                        <span class="card-icon">üìù</span>
                        <h3>Summary</h3>
                    </div>
                    <div class="card-content" id="summaryContent">
                        <p>Loading summary...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>

    <script>
        // Railway API configuration
        const RAILWAY_API = 'https://ai-journal-backend-production.up.railway.app';
        
        // Initialize application
        console.log('ü§ñ AI Journal Summarizer - MVP v1.0');
        console.log('üéØ Phase 1: Journal Interface Ready');
        
        // Character count and input validation
        function updateCharCount() {
            const input = document.getElementById('journalInput');
            const charCount = document.getElementById('charCount');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            const length = input.value.length;
            charCount.textContent = `${length}/5000 characters`;
            
            // Enable button if between 50-5000 characters
            if (length >= 50 && length <= 5000) {
                analyzeBtn.disabled = false;
                charCount.style.color = '#00ff88';
            } else {
                analyzeBtn.disabled = true;
                charCount.style.color = length > 5000 ? '#ff4444' : '#888';
            }
        }
        
        // Show loading state
        function showLoadingState() {
            document.getElementById('loadingSection').classList.add('active');
            document.querySelector('.journal-section').style.opacity = '0.5';
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('errorMessage').classList.remove('active');
        }
        
        // Hide loading state
        function hideLoadingState() {
            document.getElementById('loadingSection').classList.remove('active');
            document.querySelector('.journal-section').style.opacity = '1';
            document.getElementById('analyzeBtn').disabled = false;
        }
        
        // Show error message
        function showError(message) {
            hideLoadingState();
            const errorMsg = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorMsg.classList.add('active');
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorMsg.classList.remove('active');
            }, 5000);
        }
        
        // Display analysis results
        function displayAnalysisResults(results) {
            hideLoadingState();
            
            // Update content
            document.getElementById('sentimentContent').innerHTML = 
                `<p><strong>Sentiment:</strong> ${results.sentiment.result}</p>
                 <p style="font-size: 0.9rem; color: #888;">Confidence: ${Math.round((results.sentiment.confidence || 0.8) * 100)}%</p>`;
            
            document.getElementById('insightsContent').innerHTML = 
                `<p>${results.insights.result}</p>
                 <p style="font-size: 0.9rem; color: #888;">Model: ${results.insights.metadata?.model || 'AI Analysis'}</p>`;
            
            document.getElementById('summaryContent').innerHTML = 
                `<p>${results.summary.result}</p>
                 <p style="font-size: 0.9rem; color: #888;">Word count: ${results.summary.metadata?.word_count || 'N/A'}</p>`;
            
            // Show results section
            document.getElementById('resultsSection').classList.add('active');
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
        
        // Save entry to localStorage
        function saveEntryToHistory(text, analysis) {
            try {
                const entry = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    text: text,
                    analysis: analysis,
                    wordCount: text.split(/\s+/).length
                };
                
                let history = JSON.parse(localStorage.getItem('journal-entries') || '[]');
                history.unshift(entry); // Add to beginning
                
                // Keep only last 50 entries
                if (history.length > 50) {
                    history = history.slice(0, 50);
                }
                
                localStorage.setItem('journal-entries', JSON.stringify(history));
                console.log('üíæ Entry saved to localStorage');
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not save to localStorage:', error);
            }
        }
        
        // Main analysis function
        async function analyzeEntry() {
            const text = document.getElementById('journalInput').value.trim();
            const selectedModel = document.getElementById('modelSelect').value;
            
            // Validate input
            if (text.length < 50) {
                showError('Please write at least 50 characters for meaningful analysis.');
                return;
            }
            
            if (text.length > 5000) {
                showError('Please keep your entry under 5000 characters.');
                return;
            }
            
            // Show loading
            showLoadingState();
            
            try {
                console.log(`ü§ñ Starting AI analysis with model: ${selectedModel}...`);
                
                // Call all AI endpoints in parallel for performance with selected model
                const [sentimentRes, insightsRes, summaryRes] = await Promise.all([
                    fetch(`${RAILWAY_API}/api/ai/sentiment`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text, task_type: 'sentiment', model: selectedModel })
                    }),
                    fetch(`${RAILWAY_API}/api/ai/insights`, {
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text, task_type: 'insights', model: selectedModel })
                    }),
                    fetch(`${RAILWAY_API}/api/ai/summarize`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text, task_type: 'summarize', model: selectedModel })
                    })
                ]);
                
                // Check if all requests were successful
                if (!sentimentRes.ok || !insightsRes.ok || !summaryRes.ok) {
                    throw new Error('One or more AI services are unavailable');
                }
                
                // Parse responses
                const sentiment = await sentimentRes.json();
                const insights = await insightsRes.json();
                const summary = await summaryRes.json();
                
                console.log('‚úÖ AI analysis complete');
                
                // Prepare results
                const results = { sentiment, insights, summary };
                
                // Display results
                displayAnalysisResults(results);
                
                // Save to localStorage
                saveEntryToHistory(text, results);
                
                // Update status
                document.getElementById('status').textContent = `Analysis Complete with ${selectedModel} ‚úÖ`;
                document.getElementById('status').style.color = '#00ff88';
                
            } catch (error) {
                console.error('‚ùå AI Analysis Error:', error);
                showError(`Analysis failed: ${error.message}. Please check your connection and try again.`);
                
                // Update status
                document.getElementById('status').textContent = 'Analysis Failed ‚ùå';
                document.getElementById('status').style.color = '#ff4444';
            }
        }
        
        // Start new entry
        function startNewEntry() {
            // Clear input
            document.getElementById('journalInput').value = '';
            updateCharCount();
            
            // Hide results
            document.getElementById('resultsSection').classList.remove('active');
            
            // Scroll to top
            document.querySelector('.journal-section').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            // Focus on input
            setTimeout(() => {
                document.getElementById('journalInput').focus();
            }, 500);
        }
        
        // Test Railway API connection
        function testRailwayAPI() {
            console.log('üåê Testing Railway backend...');
            document.getElementById('status').textContent = 'Testing...';
            document.getElementById('status').style.color = '#ffaa00';
            
            fetch(`${RAILWAY_API}/health`)
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Railway API working:', data);
                    document.getElementById('status').textContent = 'Railway Connected ‚úÖ';
                    document.getElementById('status').style.color = '#00ff88';
                })
                .catch(error => {
                    console.error('‚ùå Railway API error:', error);
                    document.getElementById('status').textContent = 'Railway Error ‚ùå';
                    document.getElementById('status').style.color = '#ff4444';
                });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on journal input
            document.getElementById('journalInput').focus();
            
            // Test API connection
            setTimeout(testRailwayAPI, 1000);
            
            // Add pulsing animation to title
            setTimeout(() => {
                document.querySelector('.title').style.animation = 'pulse 3s infinite';
            }, 1500);
        });
        
        // Load entry history count
        function updateHistoryCount() {
            try {
                const history = JSON.parse(localStorage.getItem('journal-entries') || '[]');
                console.log(`üìö ${history.length} journal entries in history`);
            } catch (error) {
                console.warn('‚ö†Ô∏è Could not load history:', error);
            }
        }
        
        // Initialize history count
        updateHistoryCount();
    </script>
</body>
</html>
